<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyberpunk Time Widget</title>
  <style>
    :root {
      --bg-dark: #121212;
      --accent-1: #00ffcc;
      --accent-2: #ff00ff;
      --text-light: #e0e0e0;
      --text-muted: #777;
      --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: transparent;
      font-family: var(--font-main);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .widget-container {
      width: 320px;
      height: 300px;
      background-color: var(--bg-dark);
      border-radius: 18px;
      box-shadow: 0 0 12px rgba(255, 0, 128, 0.4);
      overflow: hidden;
      position: relative;
    }
    .info-button {
      position: absolute;
      top: 6px;
      right: 10px;
      font-size: 18px;
      color: #888;
      cursor: pointer;
      z-index: 20;
    }
    .popup {
      position: absolute;
      top: 32px;
      right: 10px;
      width: 220px;
      background: #1e1e1e;
      color: var(--text-light);
      font-size: 12px;
      padding: 10px;
      border: 1px solid #333;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(255, 0, 128, 0.3);
      display: none;
      z-index: 10;
    }
    .swiper {
      display: flex;
      width: 960px;
      height: 100%;
      transition: transform 0.3s ease-in-out;
    }
    .panel {
      width: 320px;
      height: 300px;
      padding: 18px 16px 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      color: var(--text-light);
      position: relative;
    }
    .time-display, .clock-display {
      font-size: 52px;
      font-weight: bold;
      color: var(--accent-1);
      letter-spacing: 2px;
      margin-top: 12px;
      width: 100%;
      text-align: center;
      overflow: hidden;
      cursor: pointer;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: #333;
      border-radius: 8px;
      overflow: hidden;
      margin: 12px 0;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      width: 0%;
      transition: width 1s linear;
    }
    .button-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .start-button {
      background-color: var(--accent-1);
      border: none;
      border-radius: 20px;
      padding: 6px 20px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
    }
    .cancel-button {
      background: none;
      border: none;
      color: var(--text-muted);
      font-weight: bold;
      font-size: 13px;
      cursor: pointer;
    }
    .lap-log {
      width: 100%;
      max-height: 60px;
      overflow-y: auto;
      font-size: 13px;
      font-family: monospace;
      border-top: 1px solid #333;
      padding-top: 4px;
    }
    .lap-log div {
      color: var(--accent-2);
    }
    .dots {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      padding-bottom: 8px;
    }
    .dot {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin: 0 12px;
      background-color: #444;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }
    .dot.active {
      background-color: var(--accent-1);
    }
    .dot:hover {
      background-color: var(--accent-2);
    }
    .city-label {
      font-size: 13px;
      color: var(--accent-2);
    }
    .day-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    .mode-label {
      font-size: 14px;
      font-weight: bold;
      color: var(--text-light);
      margin-top: 8px;
    }
    .flash {
      animation: flash 0.5s alternate 3;
    }
    @keyframes flash {
      from { background-color: var(--bg-dark); }
      to { background-color: #ff0066; }
    }
  </style>
</head>
<body>
  <div class="widget-container">
    <div class="swiper" id="swiper">
      <!-- Clock Panel -->
      <div class="panel" id="clock-panel">
        <div class="clock-display" id="clock-display">--:--:--</div>
        <div class="progress-bar"><div class="progress" id="day-progress"></div></div>
        <div class="city-label" id="city-label">Loading...</div>
        <div class="day-label" id="day-label"></div>
        <div class="mode-label">Local Time</div>
      </div>
      <!-- Stopwatch Panel -->
      <div class="panel" id="stopwatch-panel">
        <div class="time-display" id="stopwatch-display">00:00</div>
        <div class="progress-bar"><div class="progress"></div></div>
        <div class="button-stack">
          <button class="start-button" id="sw-start-btn">Start</button>
          <button class="cancel-button" id="sw-reset-btn">Reset</button>
        </div>
        <div class="lap-log" id="lap-log"></div>
        <div class="mode-label">Stopwatch</div>
      </div>
      <!-- Timer Panel -->
      <div class="panel" id="timer-panel">
        <div class="time-display" id="timer-display">00:00</div>
        <div class="progress-bar"><div class="progress" id="timer-progress"></div></div>
        <div class="button-stack">
          <button class="start-button" id="timer-start-btn">Start</button>
          <button class="cancel-button" id="timer-cancel-btn">Cancel</button>
        </div>
        <div class="mode-label">Countdown Timer</div>
      </div>
    </div>
    <div class="info-button" id="info-btn">?</div>
    <div class="popup" id="info-popup">
      <strong>How to Use:</strong><br>
      • Swipe or tap dots to change modes<br>
      • Tap countdown to set time<br>
      • Stopwatch has Lap + Reset<br>
      • Timer alerts with sound + flash<br>
      • Clock shows your current city
    </div>
    <div class="dots">
      <span class="dot active" data-index="0"></span>
      <span class="dot" data-index="1"></span>
      <span class="dot" data-index="2"></span>
    </div>
    <audio id="alarm-sound" src="https://www.soundjay.com/button/beep-07.wav" preload="auto"></audio>
  </div>

  <script>
    const swiper = document.getElementById('swiper');
    const dots = document.querySelectorAll('.dot');
    let currentIndex = 0;

    function updateSwiper(index) {
      swiper.style.transform = `translateX(-${index * 320}px)`;
      dots.forEach(dot => dot.classList.remove('active'));
      dots[index].classList.add('active');
      currentIndex = index;
    }

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        updateSwiper(parseInt(dot.getAttribute('data-index')));
      });
    });

    // Swipe support (basic)
    let startX = 0;
    swiper.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });
    swiper.addEventListener('touchend', (e) => {
      let endX = e.changedTouches[0].clientX;
      if (startX - endX > 50 && currentIndex < 2) updateSwiper(currentIndex + 1);
      if (endX - startX > 50 && currentIndex > 0) updateSwiper(currentIndex - 1);
    });

    // Clock
    function updateClock() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');
      document.getElementById('clock-display').textContent = `${hours}:${minutes}:${seconds}`;

      const percent = ((hours * 3600 + minutes * 60 + seconds) / 86400) * 100;
      document.getElementById('day-progress').style.width = `${percent}%`;

      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      document.getElementById('day-label').textContent = days[now.getDay()];
    }
    setInterval(updateClock, 1000);
    updateClock();

    fetch('https://ipapi.co/json/')
      .then(res => res.json())
      .then(data => document.getElementById('city-label').textContent = data.city || 'Your City');

    // Stopwatch
    let swInterval, swSeconds = 0, running = false;
    const swDisplay = document.getElementById('stopwatch-display');
    const lapLog = document.getElementById('lap-log');

    function updateSWDisplay() {
      swDisplay.textContent = String(Math.floor(swSeconds / 60)).padStart(2, '0') + ':' + String(swSeconds % 60).padStart(2, '0');
    }

    document.getElementById('sw-start-btn').addEventListener('click', () => {
      if (!running) {
        swInterval = setInterval(() => {
          swSeconds++;
          updateSWDisplay();
        }, 1000);
        running = true;
        document.getElementById('sw-start-btn').textContent = 'Lap';
      } else {
        const lap = swDisplay.textContent;
        const div = document.createElement('div');
        div.textContent = lap;
        lapLog.prepend(div);
      }
    });

    document.getElementById('sw-reset-btn').addEventListener('click', () => {
      clearInterval(swInterval);
      swSeconds = 0;
      running = false;
      updateSWDisplay();
      lapLog.innerHTML = '';
      document.getElementById('sw-start-btn').textContent = 'Start';
    });

    // Timer
    let timerInterval, timerSeconds = 0;
    const timerDisplay = document.getElementById('timer-display');
    const timerProgress = document.getElementById('timer-progress');
    const alarmSound = document.getElementById('alarm-sound');

    function updateTimerDisplay() {
      timerDisplay.textContent = String(Math.floor(timerSeconds / 60)).padStart(2, '0') + ':' + String(timerSeconds % 60).padStart(2, '0');
    }

    timerDisplay.addEventListener('click', () => {
      const input = prompt("Enter time (MMSS):");
      if (input && /^\d{1,4}$/.test(input)) {
        let padded = input.padStart(4, '0');
        let min = parseInt(padded.slice(0, 2));
        let sec = parseInt(padded.slice(2, 4));
        timerSeconds = min * 60 + sec;
        updateTimerDisplay();
        timerProgress.style.width = '100%';
      }
    });

    document.getElementById('timer-start-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      const total = timerSeconds;
      timerInterval = setInterval(() => {
        if (timerSeconds > 0) {
          timerSeconds--;
          updateTimerDisplay();
          timerProgress.style.width = `${(timerSeconds / total) * 100}%`;
        } else {
          clearInterval(timerInterval);
          timerProgress.style.width = '0%';
          alarmSound.play();
          document.getElementById('timer-panel').classList.add('flash');
          setTimeout(() => {
            document.getElementById('timer-panel').classList.remove('flash');
          }, 1500);
        }
      }, 1000);
    });

    document.getElementById('timer-cancel-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      timerSeconds = 0;
      updateTimerDisplay();
      timerProgress.style.width = '0%';
    });

    // Info
    document.getElementById('info-btn').addEventListener('click', () => {
      const popup = document.getElementById('info-popup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    });
  </script>
</body>
</html>
