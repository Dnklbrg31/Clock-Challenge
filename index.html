<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyberpunk Time Widget</title>
  <style>
    :root {
      --bg-dark: #121212;
      --accent-1: #00ffcc;
      --accent-2: #ff00ff;
      --text-light: #e0e0e0;
      --text-muted: #777;
      --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: transparent;
      font-family: var(--font-main);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .widget-container {
      width: 320px;
      height: 300px;
      background-color: var(--bg-dark);
      border-radius: 18px;
      box-shadow: 0 0 12px rgba(255, 0, 128, 0.4);
      overflow: hidden;
      position: relative;
    }
    .info-button {
      position: absolute;
      top: 6px;
      right: 10px;
      font-size: 18px;
      color: #888;
      cursor: pointer;
      z-index: 20;
    }
    .popup {
      position: absolute;
      top: 32px;
      right: 10px;
      width: 220px;
      background: #1e1e1e;
      color: var(--text-light);
      font-size: 12px;
      padding: 10px;
      border: 1px solid #333;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(255, 0, 128, 0.3);
      display: none;
      z-index: 10;
    }
    .swiper {
      display: flex;
      width: 960px;
      height: 100%;
      transition: transform 0.3s ease-in-out;
    }
    .panel {
      width: 320px;
      height: 300px;
      padding: 18px 16px 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      color: var(--text-light);
      position: relative;
    }
    .time-display, .clock-display {
      font-size: 52px;
      font-weight: bold;
      color: var(--accent-1);
      letter-spacing: 2px;
      margin-top: 12px;
      width: 100%;
      text-align: center;
      overflow: hidden;
      cursor: pointer;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: #333;
      border-radius: 8px;
      overflow: hidden;
      margin: 12px 0;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      width: 0%;
      transition: width 1s linear;
    }
    .button-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .start-button, .lap-button {
      background-color: var(--accent-1);
      border: none;
      border-radius: 20px;
      padding: 6px 20px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
    }
    .cancel-button {
      background: none;
      border: none;
      color: var(--text-muted);
      font-weight: bold;
      font-size: 13px;
      cursor: pointer;
    }
    .lap-log {
      width: 100%;
      max-height: 60px;
      overflow-y: auto;
      font-size: 13px;
      font-family: monospace;
      border-top: 1px solid #333;
      padding-top: 4px;
    }
    .lap-log div {
      color: var(--accent-2);
    }
    .dots {
      position: absolute;
      bottom: 18px;
      width: 100%;
      text-align: center;
      padding-bottom: 8px;
    }
    .dot {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin: 0 12px;
      background-color: #444;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }
    .dot.active {
      background-color: var(--accent-1);
    }
    .dot:hover {
      background-color: var(--accent-2);
    }
    .city-label {
      font-size: 13px;
      color: var(--accent-2);
      margin-bottom: 2px;
    }
    .mode-label {
      font-size: 14px;
      font-weight: bold;
      color: var(--text-light);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="widget-container">
    <div class="swiper" id="swiper">
      <!-- Clock Panel -->
      <div class="panel" id="clock-panel">
        <div class="clock-display" id="clock-display">--:--</div>
        <div class="progress-bar"><div class="progress" id="clock-progress"></div></div>
        <div class="city-label" id="city-label">Loading...</div>
        <div class="mode-label">Local Time</div>
      </div>
      <!-- Stopwatch Panel -->
      <div class="panel" id="stopwatch-panel">
        <div class="time-display" id="stopwatch-display">00:00</div>
        <div class="progress-bar"><div class="progress"></div></div>
        <div class="button-stack">
          <button class="start-button" id="lap-btn">Lap</button>
          <button class="cancel-button" id="reset-btn">Reset</button>
        </div>
        <div class="lap-log" id="lap-log"></div>
        <div class="mode-label">Stopwatch</div>
      </div>
      <!-- Timer Panel -->
      <div class="panel" id="timer-panel">
        <div class="time-display" id="timer-display">00:00</div>
        <div class="progress-bar"><div class="progress" id="timer-progress"></div></div>
        <div class="button-stack">
          <button class="start-button" id="start-btn">Start</button>
          <button class="cancel-button" id="cancel-btn">Cancel</button>
        </div>
        <div class="mode-label">Countdown Timer</div>
      </div>
    </div>
    <div class="info-button" id="info-btn">?</div>
    <div class="popup" id="info-popup">
      <strong>How to Use:</strong><br>
      Swipe left or right to switch modes.<br>
      Tap the countdown time to set it manually.<br>
      Click Lap to log times.<br>
      Clock shows your current location time.
    </div>
    <div class="dots">
      <span class="dot active" data-index="0"></span>
      <span class="dot" data-index="1"></span>
      <span class="dot" data-index="2"></span>
    </div>
    <audio id="alarm-sound" src="https://www.soundjay.com/button/beep-07.wav" preload="auto"></audio>
  </div>
  <script>
    const swiper = document.getElementById('swiper');
    const dots = document.querySelectorAll('.dot');
    let currentIndex = 0;

    function updateSwiper(index) {
      swiper.style.transform = `translateX(-${index * 320}px)`;
      dots.forEach(dot => dot.classList.remove('active'));
      dots[index].classList.add('active');
      currentIndex = index;
    }

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        updateSwiper(parseInt(dot.getAttribute('data-index')));
      });
    });

    // Clock update and day progress
    function updateClock() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
      document.getElementById('clock-display').textContent = timeString;
      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
      const percentOfDay = (totalSeconds / 86400) * 100;
      document.getElementById('clock-progress').style.width = `${percentOfDay}%`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Fetch city name
    fetch('https://ipapi.co/json/')
      .then(response => response.json())
      .then(data => {
        document.getElementById('city-label').textContent = data.city || 'Your City';
      });

    // Timer logic
    let timerSeconds = 0;
    let timerInterval;
    const timerDisplay = document.getElementById('timer-display');
    const progressBar = document.getElementById('timer-progress');
    const alarmSound = document.getElementById('alarm-sound');

    timerDisplay.addEventListener('click', () => {
      const input = prompt("Enter time in MMSS format:");
      if (input && /^\d{1,4}$/.test(input)) {
        let padded = input.padStart(4, '0');
        let minutes = parseInt(padded.slice(0, 2));
        let seconds = parseInt(padded.slice(2, 4));
        timerSeconds = minutes * 60 + seconds;
        updateTimerDisplay();
        updateProgressBar();
      }
    });

    function updateTimerDisplay() {
      let m = String(Math.floor(timerSeconds / 60)).padStart(2, '0');
      let s = String(timerSeconds % 60).padStart(2, '0');
      timerDisplay.textContent = `${m}:${s}`;
    }

    function updateProgressBar() {
      const total = parseInt(timerDisplay.dataset.total) || timerSeconds;
      const percent = timerSeconds / total * 100;
      progressBar.style.width = `${percent}%`;
    }

    document.getElementById('start-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      const total = timerSeconds;
      timerDisplay.dataset.total = total;
      timerInterval = setInterval(() => {
        if (timerSeconds > 0) {
          timerSeconds--;
          updateTimerDisplay();
          updateProgressBar();
        } else {
          clearInterval(timerInterval);
          alarmSound.play();
        }
      }, 1000);
    });

    document.getElementById('cancel-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      timerSeconds = 0;
      updateTimerDisplay();
      progressBar.style.width = '0%';
    });

    // Info popup toggle
    document.getElementById('info-btn').addEventListener('click', () => {
      const popup = document.getElementById('info-popup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    });
  </script>
</body>
</html>
